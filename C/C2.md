# ARIMA时间序列预测模型

## 模型简介

ARIMA(AutoRegressive Integrated Moving Average)是一种经典的时间序列预测模型，结合了自回归(AR)、差分(I)和移动平均(MA)三个部分，适用于预测具有趋势和季节性的时间序列数据。

## 适用场景

### 数学建模竞赛中的典型应用

1. **经济预测** - GDP、股价、汇率等经济指标预测
2. **销售预测** - 产品销量、市场需求预测
3. **人口预测** - 人口增长、人口迁移趋势分析
4. **气象预测** - 温度、降雨量等气象数据预测
5. **能源消耗** - 电力消费、能源需求预测
6. **交通流量** - 道路流量、客运需求预测
7. **医疗资源** - 患者数量、床位需求预测
8. **库存管理** - 库存水平、采购需求预测

### 典型问题特征

- 数据按时间顺序排列
- 存在趋势、周期性或季节性模式
- 数据点之间存在时间依赖关系
- 需要基于历史数据预测未来值

## 算法原理

### ARIMA(p,d,q)模型组成

1. **AR(p)自回归**: 当前值与前p个历史值的线性组合
   - $X_t = c + \phi_1 X_{t-1} + \phi_2 X_{t-2} + ... + \phi_p X_{t-p} + \varepsilon_t$

2. **I(d)差分**: 对原序列进行d次差分使其平稳
   - 一阶差分: $\Delta X_t = X_t - X_{t-1}$
   - 二阶差分: $\Delta^2 X_t = \Delta X_t - \Delta X_{t-1}$

3. **MA(q)移动平均**: 当前值与前q个预测误差的线性组合
   - $X_t = \mu + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + ... + \theta_q \varepsilon_{t-q}$

### 参数确定方法

1. **d值确定**: 通过ADF检验确定差分次数
2. **p值确定**: 观察PACF图的截尾性
3. **q值确定**: 观察ACF图的截尾性
4. **自动选择**: 使用AIC/BIC准则网格搜索

## 使用方法

### 1. 基本调用

```python
from M_C2_ARIMA import *
import pandas as pd
import numpy as np

# 加载时间序列数据
data = pd.read_csv('your_data.csv', parse_dates=['date'], index_col='date')
series = data['value']

# 创建并拟合ARIMA模型
model = ARIMA(series, order=(1, 1, 1))
fitted_model = model.fit()

# 进行预测
forecast_steps = 10
forecast = fitted_model.get_forecast(steps=forecast_steps)
forecast_values = forecast.predicted_mean
confidence_intervals = forecast.conf_int()

# 查看结果
print("预测值:")
print(forecast_values)
print("置信区间:")
print(confidence_intervals)
```

### 2. 参数确定步骤

```python
from statsmodels.tsa.stattools import adfuller
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf

# 步骤1: 平稳性检验
def check_stationarity(series):
    result = adfuller(series)
    print(f'ADF统计量: {result[0]}')
    print(f'p-value: {result[1]}')
    return result[1] < 0.05  # p<0.05表示平稳

# 步骤2: 差分处理
diff_series = series.diff().dropna()
if not check_stationarity(series):
    if check_stationarity(diff_series):
        d = 1
    else:
        diff2_series = diff_series.diff().dropna()
        if check_stationarity(diff2_series):
            d = 2

# 步骤3: 确定p和q
plot_acf(diff_series, lags=20)
plot_pacf(diff_series, lags=20)
plt.show()
```

### 3. 模型选择和验证

```python
from statsmodels.stats.diagnostic import acorr_ljungbox
import itertools

# 网格搜索最优参数
def auto_arima(series, max_p=3, max_d=2, max_q=3):
    best_aic = float('inf')
    best_order = None
    
    for p, d, q in itertools.product(range(max_p+1), range(max_d+1), range(max_q+1)):
        try:
            model = ARIMA(series, order=(p, d, q))
            fitted = model.fit()
            aic = fitted.aic
            if aic < best_aic:
                best_aic = aic
                best_order = (p, d, q)
        except:
            continue
    
    return best_order, best_aic

# 模型诊断
def model_diagnostics(fitted_model):
    residuals = fitted_model.resid
    
    # 残差白噪声检验
    ljung_box = acorr_ljungbox(residuals, lags=10, return_df=True)
    print("Ljung-Box检验结果:")
    print(ljung_box)
    
    # 残差分析图
    fitted_model.plot_diagnostics(figsize=(12, 8))
    plt.show()
```

### 4. 季节性ARIMA (SARIMA)

```python
# 对于具有季节性的数据
from statsmodels.tsa.arima.model import ARIMA

# SARIMA(p,d,q)(P,D,Q,s) 模型
model = ARIMA(series, 
              order=(1, 1, 1),           # 非季节性部分
              seasonal_order=(1, 1, 1, 12))  # 季节性部分，周期s=12
fitted_model = model.fit()
```

## 注意事项

### 数据要求

1. **时间顺序**: 数据必须按时间顺序排列
2. **等间距**: 时间间隔应该相等（日、月、年等）
3. **足够长度**: 至少需要50个以上的观测点
4. **无缺失值**: 需要处理缺失值问题

### 模型假设

1. **平稳性**: 差分后序列应该平稳
2. **线性关系**: 假设变量间为线性关系
3. **正态残差**: 残差应服从正态分布
4. **无自相关**: 残差应该是白噪声

### 常见问题

1. **过度拟合**: 参数过多可能导致过拟合
2. **趋势变化**: 结构性变化会影响预测效果
3. **异常值**: 异常值对模型影响较大
4. **季节性**: 复杂季节性需要SARIMA模型

## 代码文件

- **文件名**: `M_C2_ARIMA.py`
- **主要库**: `statsmodels.tsa.arima.model.ARIMA`
- **示例**: 带趋势和季节性的虚拟时间序列预测

## 扩展应用

### 高级模型

1. **SARIMA**: 处理季节性时间序列
2. **VAR**: 向量自回归，多变量时间序列
3. **GARCH**: 处理波动率建模
4. **状态空间模型**: 更灵活的时间序列框架

### 现代方法

1. **Prophet**: Facebook开源的时间序列预测工具
2. **LSTM**: 深度学习方法处理长期依赖
3. **Transformer**: 注意力机制的时间序列模型
4. **AutoML**: 自动化时间序列建模

### 实用技巧

1. **数据预处理**: 异常值检测、缺失值插值
2. **特征工程**: 添加节假日、事件等外生变量
3. **模型融合**: 结合多个模型提高预测精度
4. **滚动预测**: 动态更新模型进行在线预测

### 评估指标

- **MAE**: 平均绝对误差
- **RMSE**: 均方根误差
- **MAPE**: 平均绝对百分比误差
- **AIC/BIC**: 模型选择准则